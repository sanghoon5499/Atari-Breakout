<!DOCTYPE html>
<html>
<head>
  <title></title>
    <style>
    html, body {
        height: 100%;
        margin: 0;
    }

    body {
        background: black;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    </style>
</head>
<body>
    <canvas width="750" height="585" id="game"></canvas>
        <script>
            const canvas = document.getElementById('game');
            const context = canvas.getContext('2d');
            const grid = 15; // called grid because each "pixel" is a grid unit, hence why code counts in grid units
            const paddleHeight = grid; // 15
            const maxPaddleY = 640;

            var paddleSpeed = 20;
            var ballSpeed = 5;


            const paddle = {
                // start in the middle of the game on the right side
                x: canvas.width/2,
                y: canvas.height-50,
                width: grid*7,
                height: paddleHeight,

                // paddle velocity
                dx: 0
            }

            const ball = {
                // start in the middle of the game
                x: canvas.width / 2,
                y: canvas.height / 2,
                width: grid,
                height: grid,

                // keep track of when need to reset the ball position
                resetting: false,

                // ball velocity (start going to the top-right corner)
                dx: ballSpeed,
                dy: -ballSpeed
            };

            // check for collision between two objects using axis-aligned bounding box (AABB)
            // @see https://developer.mozilla.org/en-US/docs/Games/Techniques/2D_collision_detection
            function collides(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                    obj1.x + obj1.width > obj2.x &&
                    obj1.y < obj2.y + obj2.height &&
                    obj1.y + obj1.height > obj2.y;
            }

            // game loop
            function loop() {
                requestAnimationFrame(loop);
                context.clearRect(0,0,canvas.width,canvas.height);

                // move paddles by their velocity
                paddle.x += paddle.dx;

                // prevent paddles from going through walls

                if (paddle.x < 5) {
                    paddle.x = 5;
                }
                else if (paddle.x > maxPaddleY) {
                    paddle.x = maxPaddleY;
                }

                // draw paddle
                context.fillStyle = 'white';
                context.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
                
                // move ball by its velocity
                ball.x += ball.dx;
                ball.y += ball.dy;

                // prevent ball from going through walls by changing its velocity
                if (ball.y < grid) {  //top
                    ball.y = grid;
                    ball.dy *= -1;
                }

                else if (ball.x > canvas.width - grid) {  //left
                    ball.x = canvas.width - grid;
                    ball.dx *= -1;
                }

                else if (ball.x < grid) {  //right
                    ball.x = grid;
                    ball.dx *= -1;
                }
             
                // check to see if ball collides with paddle. if they do change x velocity
                if (collides(ball, paddle)) {
                    ball.dy *= -1;

                    // move ball above the paddle otherwise the collision will happen again
                    // in the next frame
                    ball.y = paddle.y - ball.width;
                }

                // draw ball
                context.fillRect(ball.x, ball.y, ball.width, ball.height);

                // draw walls
                context.fillStyle = 'white';
                context.fillRect(0, canvas.height - 15, canvas.width, canvas.height);
                context.fillRect(0, canvas.height - 1153, canvas.width, canvas.height);
            }

            // listen to keyboard events to move the paddles
            document.addEventListener('keydown', function(e) {

                // up arrow key
                if (e.which === 39) {
                    paddle.dx = paddleSpeed;
                }
                // down arrow key
                else if (e.which === 37) {
                    paddle.dx = -paddleSpeed;
                }

            });

            // listen to keyboard events to stop the paddle if key is released
            document.addEventListener('keyup', function(e) {
                if (e.which === 39 || e.which === 37) {
                    paddle.dx = 0;
                }

            });

            // start the game
            requestAnimationFrame(loop);
        </script>
    </body>
</html>
